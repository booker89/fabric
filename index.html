<script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.4.6/fabric.min.js"></script>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FABRIC</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
	<canvas id="canvas" width="400" height="350"></canvas>
	<input type="file" id="image_load"/>
	<button id="delate_btn">Delate All</button>
	<a id="image_save" class="btn" href="#">Save Image</a>
	<a id="image_font" class="btn" href="#">Move to the front</a>
	<a id="image_back" class="btn" href="#">Move to the back</a>
	<div class="container_img">
		<img src="image/flower.jpg" alt="">
		<img src="image/bear.png" alt="" >
		<img src="data:image/png;base64,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"/>
	</div>
	<ul id="containerLayers">
	</ul>
	<br>
	

</body>

<script>
	const card = new fabric.Canvas('canvas') 
// ...這裡可以寫canvas對象的一些配置
// 如果<canvas>標籤沒設置寬高，可以通過js動態設置

	// 設背景顏色
	// card.setBackgroundColor('pink');
	card.setWidth(400);
	card.setHeight(350);
	// 

	// this.selectedObj = card.getActiveObject(); 
	// card.on('selection:created', (e) => {
// 初次選中的圖層
		// console.log(e.target)
// 	this.selectedObj = e.target
// 	// console.log(this.selectedObj)
// })



// -----------------
// 上傳圖片
var imageLoader = document.querySelector('#image_load');
imageLoader.addEventListener('change', uploadImage, false);
// function uploadImage(e){
// 	console.log(e.target.files)
// }

function uploadImage(e) {
    var reader = new FileReader();
		// console.log(reader)
    reader.onload = function (event) {
				
        var img = new Image();
				// console.log(img)
        img.onload = function () {
            var imgInstance = new fabric.Image(img, {
                scaleX: 0.2,
                scaleY: 0.2
            })
            card.add(imgInstance);
        }
				console.log(event)
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
}

// 儲存圖片
var imageSave = document.querySelector('#image_save');
imageSave.addEventListener('click', saveImage, false);

function saveImage(e) {
	console.log(this)
    this.href = canvas.toDataURL({
        format: 'jpeg',
        quality: 0.8
    });
		// console.log(this.href)
    this.download = 'icon.png'
};


// -------------------
// 點選圖片會加到canvas上
// 參考網址:https://blog.csdn.net/qq_43759079/article/details/115357032
document.querySelectorAll(".container_img img").forEach(el => {
	// console.log(el)
	el.addEventListener("click", () => {
		// console.log(el)
		fabric.Image.fromURL( el.src, (img) => {
			// console.log(el)
			img.set({ left: 100, top: 100});//圖片在畫布的位置
		card.add(img);
		});
	});

});


// 鍵盤案Backspace或Delete圖片會消失
document.addEventListener("keydown", e => {
	if(e.key === "Backspace" || e.key === "Delete"){
		card.remove(card.getActiveObject());
	}
});

// 清除所有按鈕
document.querySelector("#delate_btn").addEventListener('click', () => {
  card.clear();
});
// ---------------



// --------------------
// 圖片移到最上層或是最下層(失敗)
// let itemFont=document.querySelector("#image_font");
// let itemBack=document.querySelector("#image_back");

// let selectedObject;

// card.on('selection:created', (e) => {
// // 選中圖層事件觸發時，動態更新賦值
// 	// console.log(e.target)
	// this.selectedObj = e.target
// 	// console.log(this.selectedObj)
// })

// itemFont.addEventListener("click", objectToFront);
// itemBack.addEventListener("click", objectToBack);
// function objectToFront(){
//  	card.bringToFront(card.getActiveObject());
//  };
// function objectToBack(){
// 	card.sendToBack(card.getActiveObject());
//  };

</script>